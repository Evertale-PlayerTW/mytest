<!DOCTYPE html>
<html lang="zh-Hant">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="icon" type="image/png"
		href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAC91BMVEUAAAAsIylCOj9VTlI1JyhBOTy1n5EvJCZJPEM3LjUlHR85LzhdUFU/MDInHiNBNDc6MTc1LDFWSkU/NjoZFhkeFxijfVk9LS8vJCxnW195al4uJSkyJyo/Mjc8MjgeFxwZERFCOUATERNlXV3y47F2XVRCN0Oukmbn2sBwZGQpHiHGuZQ7LCzLwalIODouJSYpICB3XkjBvKNFNDQqISKWiXaqm5UZExVmVlofGh8fFxlpUUGBe3hYUU1jXmT/6dBUPj5LNzlEMjM7KyxpTktOOjtALzBvUlFQOzx8XldFLjU0JiiFZFxHNTYxIyT++uz/5s3+4clpXWiLaF5bQkE2Jyz9893/69Lx5cv228X52sTl1b/eybOTi42gioWJfoSWdm5uY2pvYF2CYVlsWlluVExkTEpeRURXQkA9NUBoQT00LDlBLzdSNTYmIS8rICH69Obs6OPi3Nf36c/e1c7QysjOxcDEvLi5sK65pZqyi32TgH1/dnmAc3Cvd2yTb2OMbGOabWCdZ1xaTlx/XFmUZ1hRSFZkUlV6VVOIa1FeUVF2VE1iSUE4MD5HOjtjOzZkLTY3LDMkGh3+/PH49e/+/OT++t/n4dz38Nbx6dP99tL69Mrc18Pz5cD+9r3Qybrp2rXNvbXbwrDauqjluqVdjJbx1pXYv5Kjj4/lm4zIpouumYumlYbUkIXDiXyvlHFtZm+jcmuee2qlh2izbGekbGZ9a2VgVWSNd2OdhWBzZGCHaFt9ZlR3WFSEW1OqU1J7YlGCUUpOQUd0WkWIXkNoSUNrVUKYOUF2UDwsJDRMMDA4Iyv27eDo4dLl3NLl2Mj25sXq2sLuzrr877asvLWbs7C9uaL98KG/rqHiyp6vpZ3Xxpy/rpmXhJCwm47TsYzOmoq5k4W6poSThYKUg4LcwIF+cHaNgHSGf3O6fXKbiG+pgW9/a2y3hlqocVpLRlkzS1d0XFVrWVSccEuMUUu5QkqESkhiSUcwPUdyW0ajPESUS0OJNT5j/bk9AAAAP3RSTlMA/h0L70/+8ikQ9O/st6qJal9KSC8U/fjl5OPUspx4aEg8PDT+/fz49vHx6enf39ra1s3IxK2bmI2HhIB+Y1QrMBUfAAAC80lEQVQ4y2KgMmAVVlAQZWLFIatkziftHerNIq4jKMqMRZ7Jissrx8nVwcHXyc2bF1NeUcLb2cnV0dc13cPJ14FFGV2emc/by8vZ1cOhZa+Dq5ujBwu6Q/gZ3dxcQ9xdgt3TXBzcHdKdnXlRDFECiJHRycE3w8PJ3aU+YZNLaqpvqACKAfImbq6ODsmpe7+7uFf5JO/28XC0RFHAwe7l6JDu5OZZ7+7p6b7Jx8XDWUsESZ6Tj3GiY4ijS4hncLrP6+DkFncPLwFkBaLSjKHOzhlHu4N3N3R0dNc/9HF0skD2o7ws46R8x4yQjuQlCSFZ6xbdc3F05kcNRsZJ3n6hrhP7gh2c9jWkLPZwY0ENbQFGRj+/NLalS3e5uTz48aHLyc8ANZwAEubOT/NNK54/5/mqS4FXrsY453OhxZQgl2uLY3RYcXS4vb19QMwkb1YmtLDWz3fyWRxuH24fBcRr/Nit0WNLht3ZISoAqD0KiD+xGIsJgcIHyaVCcuJ+DYEBkZGRAfZsejKGKepAFXIcikihKct+qioqMBAozy3xs703Q1VQWJJVEuxCU20jO2B88Gc1bVwSGFkVmndsx6GTeZ5qPDWaPCCtUo8WTJttw8DMe+Ldy60bG1uP9a1Pyj6ZyZOYWFNbysBhBggFAfr+LaDldHGdJD0Uy0qKFq2ufrXDwLZpawtSg11fd3d1AChYlZrTT3Ccp9sakZCQarSprX6PwIaNbEaOUl1ddnZ4AFiTT57Xm3CYrLjW74ZskPy0qb/K8WmNbG1tSrZ4cpeXAFiUT5Wek3Od3GLosLC3xPv69cePiWluy8WPbYxecpRxAJnOT0+aVqamq2S6UmHme7Ptv8fIh7lrbYWBasK8oXdxAFh0VlaW0Keze1Jihnzj5Hl76rmMg2S8i9+qhYqJ2HJ2AFtc0Vtcr4lgmdpig1+feKLdqEnD7GFJwdl+gmtlq3R1AM8GXl5gxF7NcMx9Ul+YeXmhqIHz9Ie3voL2wW6MfV1fBUcTM3p5mhoAAAAASUVORK5CYII=" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">
	<title>「亙苦妄想」花名冊</title>
	<style>
		body {
			width: min(100%, 800px);
			margin: auto;
			padding: 0.5rem;
			box-sizing: border-box;
			font-family: "Noto Sans TC", sans-serif;
		}

		input,
		button,
		select {
			font-family: inherit;
		}

		a {
			color: inherit;
			text-decoration: none;
		}

		.chooseOption {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 3px 0;
		}

		.chooseOption label {
			flex: 1;
			text-align: center;
		}

		#filterRarity,
		#filterElement,
		#filterWeaponType,
		#filterStars {
			border: 1px solid black;
			margin: 5px 0;
			padding: 5px;
			position: relative;
		}

		.toggleAll {
			position: absolute;
			top: 0;
			left: -0.4em;
			border: none;
			background: transparent;
			width: max(3%, 1em);
			height: 100%;
			padding: 0;
			font: inherit;
		}

		.toggleAll::before {
			position: absolute;
			content: "";
			top: 50%;
			left: 0;
			background-color: gray;
			border-radius: 50%;
			width: 0.8em;
			height: 1.2em;
			transform: translateY(-50%);
		}

		#targetSelect {
			width: 100%;
			height: 2em;
			margin: 10px auto;
			font-size: 1em;
			font-family: inherit;
		}

		select {
			/* 隱藏 <select> 預設的箭頭樣式 */
			appearance: none;
			/* For modern browsers */
			-webkit-appearance: none;
			/* For Safari and Chrome */
			-moz-appearance: none;
			/* For Firefox */
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:first-child {
			text-align: center;
			text-align-last: center;
			-moz-text-align-last: center;
		}

		option:not(:first-child) {
			text-align: left;
		}

		.hidden {
			display: none !important;
		}

		hr {
			margin: 1.5em -0.5em 2em -0.5em;
		}

		#nameDisplay {
			position: relative;
		}

		#bigName {
			text-align: center;
			font-size: 3em;
			font-weight: bold;
		}

		#subName {
			text-align: center;
			font-size: 1.5em;
		}

		#codeName {
			position: absolute;
			top: -4em;
			right: 0px;
			font-size: 0.5em;
		}

		#viewContent {
			padding: 0.5em;
			margin-top: 2em;
		}

		#generalStatsArea {
			width: min(100%, 400px);
			margin: auto;
			padding: 0 0.5rem;
			border: 1px solid black;
			box-sizing: border-box;
		}

		.infoRow {
			display: flex;
			align-items: center;
			margin: 0.5rem auto;
		}

		.infoTitle {
			width: 30%;
			border: 1px solid black;
			text-align: justify;
			text-align-last: justify;
			padding: 0.2em;
		}

		.infoValue {
			width: 70%;
			text-align: center;
		}

		.areaTitle {
			text-align: center;
			font-size: 2em;
		}

		.contentBox {
			position: relative;
			border: 1px solid black;
			padding: 0.5em;
			min-height: 1.5em;
			box-sizing: border-box;
		}

		#hasAscended {
			margin-top: 1.5em;
		}

		#profileAscendedTitle {
			border: 1px solid black;
			font-size: 1.2em;
			width: 50%;
			text-align: justify;
			text-align-last: justify;
			margin: 0.5em auto;
		}

		#leaderSkillName,
		#weaponSkillName {
			border: 1px solid black;
			display: inline-block;
			margin: 0 auto 0.3em 1em;
			padding: 0 0.2em;
		}

		#activeSkillContent,
		#passiveSkillContent,
		#dialogContent,
		#relationshipContent {
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		.activeSkillDetail,
		.passiveSkillDetail {
			display: grid;
			grid-template-columns: 1fr minmax(10%, max-content) minmax(10%, max-content);
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
			gap: 0.4em;
		}

		.activeSkillName,
		.passiveSkillName,
		.relationshipName {
			display: inline-block;
			margin-left: 1em;
			border: 1px solid black;
			padding: 0 0.2em;
			width: fit-content;
		}

		.activeSkillSpirit,
		.activeSkillTU {
			text-align: center;
			border: 1px solid black;
			border-radius: 1em;
			height: 100%;
			place-content: center;
			padding: 0 0.5em;
		}

		.activeSkillDecription,
		.passiveSkillDecription,
		.relationshipMembers {
			grid-column: 1 / -1;
		}

		#dialogContent {
			gap: 1em;
		}

		.dialogGroupTitle {
			text-align: center;
			font-size: 1.2em;
		}

		.dialogText {
			border: 1px solid black;
			margin-top: 0.5em;
			padding: 0.5em;
		}

		label:has(input:disabled) {
			opacity: 0.5;
			pointer-events: none;
			cursor: not-allowed;
		}

		.relationshipAGroup {
			display: grid;
			grid-template-columns: 1fr 5em;
			align-items: center;
			border: 1px solid black;
			padding: 0.5em;
		}

		.relationshipBonus {
			text-align: center;
			border: 1px solid black;
			border-radius: 5em;
			height: 100%;
			place-content: center;
			padding: 0 0.5em;
			line-height: 1.1;
		}

		.relationshipAGroup ul {
			margin: 0.5em 1em;
			padding-left: 0.5em;
		}

		.collapseButton {
			position: absolute;
			left: 0;
			top: -0.25rem;
			background-color: transparent;
			border: 0;
			padding: 0;
			line-height: 1;
			transform: translate(-50%, -100%);
		}

		#selectableList {
			display: grid;
			grid-template-columns: 1fr auto;
			align-items: center;
		}

		#powerCalculatorContent {
			width: min(max(80%, 500px), 100%);
			margin: auto;
		}

		#pc_input {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 0.5em;
		}

		.inputBlock {
			border: 1px solid black;
			padding: 5px;
			display: flex;
			flex-direction: column;
		}

		.inputBlock input {
			width: 100%;
			box-sizing: border-box;
			margin-bottom: 0px;
			font-size: 0.75em;
			border: 0.5px dotted gray;
		}

		.hint {
			font-size: 0.7em;
			text-align: right;
		}

		#refine_wrapper {
			display: grid;
			grid-template-columns: 1fr auto;
		}

		#pc_control {
			width: 90%;
			text-align: center;
			margin: auto;
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 0.5em;
		}

		#button_maxStats {
			width: fit-content;
			justify-self: start;
		}

		#checkbox_infiniteMode {
			width: fit-content;
			justify-self: end;
		}

		#button_calcPower {
			grid-column: 1 / -1;
			font-size: 1em;
			border-radius: 5em;
			border: 1px solid black;
		}

		#pc_result_show {
			width: 75%;
			text-align: center;
			margin: auto;
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		#pc_result_show>label {
			display: grid;
			grid-template-columns: 40% 1fr;
		}

		#pc_result_show input[type="text"] {
			text-align: right;
			box-sizing: border-box;
			width: 100%;
		}

		#powerCalculatorContent hr {
			margin: 1em auto;
		}

		#checkbox_resultInvolvePassive {
			display: flex;
			justify-content: end;
			font-size: 0.75em;
			margin-top: 0.5rem;
			white-space: pre;
			text-align: right;
		}

		#prefWeapon2 {
			position: relative;
			opacity: 0.5;
		}

		#prefWeapon2::before {
			position: absolute;
			content: "&";
			left: -0.5em;
			transform: translateX(-100%);
		}
	</style>
</head>

<body>
	<div class="chooseOption" id="selectCategory">
		<label><input type="radio" name="unit_category" value="Monster" onchange="changeCategory()" checked />角色</label>
		<label><input type="radio" name="unit_category" value="Weapon" onchange="changeCategory()" />武器</label>
		<label><input type="radio" name="unit_category" value="Equipment" onchange="changeCategory()" />飾品</label>
	</div>

	<div id="filterRarity">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="N" onchange="setSelectableList(this)" checked />N</label>
			<label><input type="checkbox" value="R" onchange="setSelectableList(this)" checked />R</label>
			<label><input type="checkbox" value="SR" onchange="setSelectableList(this)" checked />SR</label>
			<label><input type="checkbox" value="SSR" onchange="setSelectableList(this)" checked />SSR</label>
		</div>
	</div>

	<div id="filterStars">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="0" onchange="setSelectableList(this)" checked />0★</label>
			<label><input type="checkbox" value="1" onchange="setSelectableList(this)" checked />1★</label>
			<label><input type="checkbox" value="2" onchange="setSelectableList(this)" checked />2★</label>
			<label><input type="checkbox" value="3" onchange="setSelectableList(this)" checked />3★</label>
			<label><input type="checkbox" value="4" onchange="setSelectableList(this)" checked />4★</label>
			<label><input type="checkbox" value="5" onchange="setSelectableList(this)" checked />5★</label>
			<label><input type="checkbox" value="6" onchange="setSelectableList(this)" checked />6★</label>
		</div>
	</div>

	<div id="filterElement" class="mo">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption">
			<label><input type="checkbox" value="Fire" onchange="setSelectableList(this)" checked />火</label>
			<label><input type="checkbox" value="Water" onchange="setSelectableList(this)" checked />水</label>
			<label><input type="checkbox" value="Earth" onchange="setSelectableList(this)" checked />地</label>
			<label><input type="checkbox" value="Air" onchange="setSelectableList(this)" checked />雷</label>
			<label><input type="checkbox" value="Life" onchange="setSelectableList(this)" checked />光</label>
			<label><input type="checkbox" value="Death" onchange="setSelectableList(this)" checked />闇</label>
		</div>
	</div>

	<div id="filterWeaponType" class="wo" style="display: none">
		<button class="toggleAll" onclick="toggleAllCheckboxes(this)"></button>
		<div class="chooseOption" id="filterWeaponTypeYellow">
			<label><input type="checkbox" value="Sword" onchange="setSelectableList(this)" checked />單手劍</label>
			<label><input type="checkbox" value="Axe" onchange="setSelectableList(this)" checked />單手斧</label>
			<label><input type="checkbox" value="Staff" onchange="setSelectableList(this)" checked />法杖</label>
			<label><input type="checkbox" value="Mace" onchange="setSelectableList(this)" checked />釘頭鎚</label>
		</div>

		<div class="chooseOption" id="filterWeaponTypeRed">
			<label><input type="checkbox" value="GreatSword" onchange="setSelectableList(this)" checked />雙手劍</label>
			<label><input type="checkbox" value="GreatAxe" onchange="setSelectableList(this)" checked />雙手斧</label>
			<label><input type="checkbox" value="Spear" onchange="setSelectableList(this)" checked />長槍</label>
			<label><input type="checkbox" value="Hammer" onchange="setSelectableList(this)" checked />大槌</label>
			<label><input type="checkbox" value="Katana" onchange="setSelectableList(this)" checked />武士刀</label>
		</div>
	</div>

	<div id="selectableList">
		<select id="targetSelect" onchange="displayData()">
			<option value="" disabled selected hidden>▼ 選擇目標 ▼</option>
		</select>
		<label><input type="checkbox" id="reverseToggle" onchange="reverseOptions()" value="false" />反序</label>
	</div>

	<hr style="margin: 1em -0.5em auto" />
	<div id="mainBlock" style="padding-top: 2em">
		<div id="nameDisplay">
			<div id="subName"></div>
			<div id="bigName"></div>
			<div id="codeName"></div>
		</div>

		<div id="viewContent">
			<div class="hidden" id="generalStatsArea">
				<div class="infoRow hidden" id="rarity">
					<div class="infoTitle">稀有度</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="stars">
					<div class="infoTitle">星數</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="preferredWeapon">
					<div class="infoTitle">擅長武器</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="weaponType">
					<div class="infoTitle">武器類型</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="element">
					<div class="infoTitle">屬性</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="cost">
					<div class="infoTitle" style="text-align: center; text-align-last: center">Cost</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="atk">
					<div class="infoTitle">攻擊力</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="hp">
					<div class="infoTitle">生命</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="speed">
					<div class="infoTitle">速度</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="power">
					<div class="infoTitle">
						<div>戰力</div>
						<div id="powerHint" style="text-align: center; text-align-last: center; font-size: 0.7em">
							(基礎能力值估算)
						</div>
					</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="freeEvo">
					<div class="infoTitle">自動進化</div>
					<div class="infoValue"></div>
				</div>
				<div class="infoRow hidden" id="visible">
					<div class="infoTitle">圖鑑可見</div>
					<div class="infoValue"></div>
				</div>
			</div>

			<div class="hidden" id="gachaIntroArea">
				<hr />
				<div class="areaTitle" id="profileTitle">召喚導言</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="gachaIntroContent">
						<div id="gachaIntroText" style="text-align: center"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="profileArea">
				<hr />
				<div class="areaTitle" id="profileTitle">簡介</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="profileContent">
						<div id="profileText"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="leaderSkillArea">
				<hr />
				<div class="areaTitle" id="leaderSkillTitle">隊長技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="leaderSkillContent">
						<div id="leaderSkillName"></div>
						<div id="leaderSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="weaponSkillArea">
				<hr />
				<div class="areaTitle" id="weaponSkillTitle">武器技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="weaponSkillContent">
						<div id="weaponSkillName"></div>
						<div id="weaponSkillDecription"></div>
					</div>
				</div>
			</div>

			<div class="hidden" id="activeSkillArea">
				<hr />
				<div class="areaTitle" id="activeSkillTitle">主動技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="activeSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="passiveSkillArea">
				<hr />
				<div class="areaTitle" id="passiveSkillTitle">被動技能</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="passiveSkillContent"></div>
				</div>
			</div>

			<div class="hidden" id="summonableMonstersArea">
				<hr />
				<div class="areaTitle" id="summonableMonstersTitle">召喚物</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="summonableMonstersContent"></div>
				</div>
			</div>

			<div class="hidden" id="dialogArea">
				<hr />
				<div class="areaTitle" id="dialogTitle">對話</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="dialogContent"></div>
				</div>
			</div>

			<div class="hidden" id="aiLogicArea">
				<hr />
				<div class="areaTitle" id="aiLogicTitle">AI邏輯</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="aiLogicContent" style="white-space: pre-wrap"></div>
				</div>
			</div>

			<div class="hidden" id="relationshipArea">
				<hr />
				<div class="areaTitle" id="relationshipTitle">夥伴</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="relationshipContent"></div>
				</div>
			</div>

			<div class="hidden" id="powerCalculatorArea">
				<hr />
				<div class="areaTitle" id="powerCalculatorTitle">戰力計算器</div>
				<div class="contentBox">
					<button class="collapseButton" onclick="collapseContent(this)">⊖</button>
					<div id="powerCalculatorContent">
						<div id="pc_input">
							<div class="inputBlock" id="pc_baseAtkInput">
								<label for="input_atkBase" id="baseAtkLabel">基礎攻擊力</label>
								<input type="number" id="input_atkBase" value="0" min="0" step="1" />
								<div class="hint" id="hint_atkBase">0~</div>
							</div>
							<div class="inputBlock" id="pc_baseHpInput">
								<label for="input_hpBase" id="baseHpLabel">基礎生命</label>
								<input type="number" id="input_hpBase" value="0" min="0" step="1" />
								<div class="hint" id="hint_hpBase">0~</div>
							</div>
							<div class="inputBlock" id="pc_starsCurrentInput">
								<label for="input_starsCurrent" id="starsCurrentLabel">星數(目前)</label>
								<input type="number" id="input_starsCurrent" value="0" min="0" max="6" step="1" />
								<div class="hint" id="hint_starsCurrent">0~6</div>
							</div>
							<div class="inputBlock" id="pc_starsMaxInput">
								<label for="input_starsMax" id="starsMaxLabel">星數(最大)</label>
								<input type="number" id="input_starsMax" value="0" min="0" max="6" step="1" />
								<div class="hint" id="hint_starsMax">0~6</div>
							</div>
							<div class="inputBlock" id="pc_limitBreakInput">
								<label for="input_limitBreak" id="limitBreakLabel">突破</label>
								<input type="number" id="input_limitBreak" value="0" min="0" max="5" step="1" />
								<div class="hint" id="hint_limitBreak">0~5</div>
							</div>
							<div class="inputBlock" id="pc_levelInput">
								<label for="input_level" id="levelLabel">等級</label>
								<input type="number" id="input_level" value="1" min="1" max="200" step="1" />
								<div class="hint" id="hint_level">1~200</div>
							</div>
							<div class="inputBlock" id="pc_awakeningInput">
								<label for="input_awakening" id="awakeningLabel">覺醒</label>
								<input type="number" id="input_awakening" value="0" min="0" max="4" step="1" />
								<div class="hint" id="hint_awakening">0~4</div>
							</div>
							<div class="inputBlock" id="pc_cosmoInput">
								<label for="input_cosmo" id="cosmoLabel">已超越</label>
								<input type="checkbox" id="input_cosmo" />
							</div>
							<div class="inputBlock" id="pc_boostInput">
								<label for="input_boost" id="boostLabel">增幅</label>
								<input type="number" id="input_boost" value="0" min="0" max="300" step="1" />
								<div class="hint" id="hint_boost">0~300</div>
							</div>
							<div class="inputBlock" id="pc_refineInput">
								<label for="input_refine" id="refineLabel">潛能</label>
								<div id="refine_wrapper">
									<input type="number" id="input_refine" value="0.00" min="0.00" max="100.00"
										step="0.01" />
									<span style="font-size: 0.75em;">%</span>
								</div>
								<div class="hint" id="hint_refine">0.00~100.00</div>
							</div>
							<div class="inputBlock" id="pc_masteryInput">
								<label for="input_mastery" id="masteryLabel">昇華</label>
								<input type="number" id="input_mastery" value="0" min="0" max="40" step="1" />
								<div class="hint" id="hint_mastery">0~40</div>
							</div>
						</div>
						<hr />
						<div id="pc_control">
							<button id="button_maxStats">一鍵最大強化</button>
							<label id="checkbox_infiniteMode"> <input type="checkbox" id="infiniteMode" />無極模式</label>
							<button id="button_calcPower">計算戰力</button>
						</div>
						<hr />
						<div id="pc_result">
							<div id="pc_result_show">
								<label>
									<span>攻擊力</span>
									<input type="text" id="result_atk" data-trueval="0" data-awkbonus="0" readonly />
								</label>
								<label>
									<span>生命</span>
									<input type="text" id="result_hp" data-trueval="0" data-awkbonus="0" readonly />
								</label>
								<label>
									<span>戰力</span>
									<input type="text" id="result_power" readonly />
								</label>
							</div>
							<label id="checkbox_resultInvolvePassive">
								<input type="checkbox" id="resultInvolvePassive" checked />
								<span>攻擊力&生命，計入被動技能加成<br />(不影響戰力計算)</span>
							</label>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<template id="template-hasAscended">
		<div id="hasAscended">
			<div id="profileAscendedTitle">・超越・</div>
			<div id="profileAscendedText"></div>
		</div>
	</template>

	<template id="template-activeSkill">
		<div class="activeSkillDetail">
			<div class="activeSkillName"></div>
			<div class="activeSkillSpirit"></div>
			<div class="activeSkillTU"></div>
			<div class="activeSkillDecription"></div>
		</div>
	</template>

	<template id="template-passiveSkill">
		<div class="passiveSkillDetail">
			<div class="passiveSkillName"></div>
			<div></div>
			<div></div>
			<div class="passiveSkillDecription"></div>
		</div>
	</template>

	<template id="template-dialog">
		<div class="dialogGroup">
			<div class="dialogGroupTitle"></div>
			<div class="dialogText"></div>
		</div>
	</template>

	<template id="template-relationship">
		<div class="relationshipAGroup">
			<div class="relationshipName"></div>
			<div class="relationshipBonus"></div>
			<div class="relationshipMembers"></div>
		</div>
	</template>

	<script>
		let unit_category = document.querySelector('input[name="unit_category"]:checked').value;
		let currentDisplayCategory = null;
		let currentDisplayID = null;
		const wholeData = {};

		document.addEventListener("DOMContentLoaded", function () {
			const url = new URL(window.location.href);
			if (url.searchParams.has("lang")) {
				url.pathname = url.pathname.replace(/Viewer\d*/, "Viewer3");
				window.location.href = url.toString();
			}
		});

		document.addEventListener("DOMContentLoaded", initPage);

		async function initPage() {
			await initFilter();
			await loadWholeData();
			await setSelectableList();
			await analyzeUrlParams();
		}
	</script>

	<script>
		/*=====篩選邏輯區塊=====*/
		const initSelectOptionContent = document.getElementById("targetSelect").innerHTML;

		function initFilter() {
			document.getElementById("selectCategory").querySelector('input[type="radio"]').checked = true;
			document.querySelectorAll('input[type="checkbox"]').forEach((c) => (c.checked = true));
			document.getElementById("reverseToggle").checked = false;
		}

		function changeCategory() {
			unit_category = document.querySelector('input[name="unit_category"]:checked').value;

			document.querySelectorAll(".mo, .wo").forEach(function (el) {
				el.style.display = "none";
			});

			if (unit_category === "Equipment") {
			} else {
				if (unit_category === "Weapon") {
					document.querySelectorAll(".wo").forEach(function (el) {
						el.style.display = "";
					});
				} else {
					document.querySelectorAll(".mo").forEach(function (el) {
						el.style.display = "";
					});
				}
			}

			document.querySelectorAll('.chooseOption input[type="checkbox"]').forEach((el) => (el.checked = true));
			document.getElementById("reverseToggle").checked = false;

			setSelectableList();
		}

		function setSelectableList(triggerElement) {
			const targetSelect = document.getElementById("targetSelect");
			targetSelect.innerHTML = initSelectOptionContent;

			const selectedRarities = Array.from(document.querySelectorAll("#filterRarity input:checked")).map(
				(cb) => cb.value
			);
			const selectedStars = Array.from(document.querySelectorAll("#filterStars input:checked")).map((cb) => cb.value);
			const selectedElements = Array.from(document.querySelectorAll("#filterElement input:checked")).map((cb) =>
				cb.parentNode.textContent.trim()
			);
			const selectedWeaponTypes = Array.from(document.querySelectorAll("#filterWeaponType input:checked")).map((cb) =>
				cb.parentNode.textContent.trim()
			);

			const filteredStars = new Set();

			for (const id in wholeData[unit_category]) {
				const entry = wholeData[unit_category][id];
				const option = document.createElement("option");

				if (!selectedRarities.includes(entry["稀有度"])) continue;
				if (unit_category === "Monster" && !selectedElements.includes(entry["屬性"])) continue;
				if (unit_category === "Weapon" && !selectedWeaponTypes.includes(entry["類型"])) continue;

				filteredStars.add(entry["目前星數"]);
				if (!selectedStars.includes(String(entry["目前星數"]))) continue;

				option.value = id;
				option.text = getFullNameAddStarsOrRarity(id, unit_category, true, false);
				targetSelect.appendChild(option);
			}

			if (document.getElementById("reverseToggle").checked) reverseOptions();
			targetSelect.selectedIndex = 0;

			if (filteredStars.size !== 0) {
				//禁用沒有的星數選項
				Array.from(document.querySelectorAll("#filterStars input")).forEach((cb) => {
					cb.disabled = false;
					if (!filteredStars.has(Number(cb.value))) {
						cb.checked = false;
						cb.disabled = true;
					}
				});

				//若非星數區塊觸發，且星數都未選，則全選
				const selectedStarsNew = Array.from(document.querySelectorAll("#filterStars input:checked")).map(
					(cb) => cb.value
				);
				if (triggerElement && !triggerElement.closest("#filterStars") && selectedStarsNew.length === 0) {
					document.querySelectorAll("#filterStars input").forEach((cb) => (cb.checked = true));
					setSelectableList();
				}
			}
		}

		function reverseOptions() {
			const selectableTarget = document.getElementById("targetSelect");
			const originalOptions = Array.from(selectableTarget.options).slice(1);
			const newOptions = originalOptions.reverse();
			selectableTarget.innerHTML = initSelectOptionContent;
			newOptions.forEach((option) => selectableTarget.appendChild(option));
			selectableTarget.selectedIndex = 0;
		}

		function toggleAllCheckboxes(toggleElement) {
			const checkboxes = toggleElement.parentElement.querySelectorAll('input[type="checkbox"]');

			// 檢查目前是否全選
			const allChecked = Array.from(checkboxes)
				.filter((cb) => !cb.disabled)
				.every((cb) => cb.checked);
			checkboxes.forEach((cb) => (cb.checked = !allChecked));

			setSelectableList();
		}
	</script>

	<script>
		/*=====載入資料區塊=====*/
		const dataUrls = {
			Monster: "https://evertale-playertw.github.io/Collection/Cht/Monster.json",
			Weapon: "https://evertale-playertw.github.io/Collection/Cht/Weapon.json",
			Equipment: "https://evertale-playertw.github.io/Collection/Cht/Accessory.json",
		};

		async function loadWholeData() {
			for (const [key, url] of Object.entries(dataUrls)) {
				try {
					const rawText = await fetch(url).then((res) => res.text());
					const jsonData = JSON.parse(rawText.replace(/\\(?![\\\/bfnrtu"])/g, "\\\\"));
					insertInfo(jsonData);
					wholeData[key] = jsonData;
				} catch (e) {
					console.error(`讀取或解析 ${key} 時發生錯誤:`, e);
				}
			}
		}

		function insertInfo(jsonData) {
			for (const id in jsonData) {
				let fullName = jsonData[id]["名字"] || id;

				if (jsonData[id]["副名"]) {
					fullName += ` - ${jsonData[id]["副名"]}`;
				}
				jsonData[id]["完整名"] = fullName;

				if (jsonData[id]["星數"]) {
					jsonData[id]["目前星數"] = jsonData[id]["星數"].split("★").length - 1;
					jsonData[id]["最大星數"] = jsonData[id]["星數"].length;
				} else {
					jsonData[id]["目前星數"] = 0;
					jsonData[id]["最大星數"] = 0;
				}

				const familyName = id.slice(0, -2);
				const numInFamily = Number(id.slice(-2));
				let evoNotFreeCount = numInFamily - 1;
				for (let i = numInFamily - 1; i > 0; i--) {
					if (jsonData?.[familyName + String(i).padStart(2, "0")]?.["自動進化"]) evoNotFreeCount--;
				}
				if (evoNotFreeCount) jsonData[id]["起始突破次"] = evoNotFreeCount;

				if (jsonData[id]["被動技能"] && jsonData[id]["被動技能"].length >= 4) {
					const passiveSkills = jsonData[id]["被動技能"];
					const awkBonusVisible = {};
					for (let i = 1; i <= 4; i++) {
						const ps_index = passiveSkills.length - 5 + i;
						if (passiveSkills[ps_index]) {
							if (passiveSkills[ps_index]["技能標題"].includes("提升生命值")) {
								awkBonusVisible[i] = { "最大生命+": Number(passiveSkills[ps_index]["技能敘述"].match(/\d+/)[0]) };
							}
							if (passiveSkills[ps_index]["技能標題"].includes("提升攻擊力")) {
								awkBonusVisible[i] = { "攻擊力+": Number(passiveSkills[ps_index]["技能敘述"].match(/\d+/)[0]) };
							}
							if (passiveSkills[ps_index]["技能標題"].includes("大師")) {
								awkBonusVisible[i] = { "擅長武器+": passiveSkills[ps_index]["技能標題"].replace("大師", "") };
							}
						}
					}
					if (Object.keys(awkBonusVisible).length > 0) jsonData[id]["被動加成外顯"] = awkBonusVisible;
				}
			}
		}
	</script>

	<script>
		/*=====資訊顯示區塊=====*/
		const initTitle = document.title;

		function displayData(id, myCategory) {
			id ??= document.getElementById("targetSelect").value;
			if (id == "") return;

			currentDisplayCategory = myCategory ?? unit_category;
			currentDisplayID = id;

			collapseReset();
			document.title = `${wholeData[currentDisplayCategory][id]["完整名"]} | ${initTitle}`;

			document.getElementById("codeName").textContent = id;
			document.getElementById("bigName").textContent = wholeData[currentDisplayCategory][id]["名字"] || id;
			if (wholeData[currentDisplayCategory][id]["副名"]) {
				document.getElementById("subName").classList.remove("hidden");
				document.getElementById("subName").textContent = wholeData[currentDisplayCategory][id]["副名"];
			} else {
				document.getElementById("subName").classList.add("hidden");
			}

			setGeneralStats(id);
			setProfile(id);
			setLeaderSkill(id);
			setWeaponSkill(id);
			setActiveSkill(id);
			setPassiveSkill(id);
			setSummonableMonsters(id);
			setGachaIntro(id);
			setDialog(id);
			setAiLogic(id);
			setRelationship(id);
			initStatsInput(id);

			document.getElementById("mainBlock").scrollIntoView();
		}

		function setGeneralStats(id) {
			document.getElementById("generalStatsArea").classList.remove("hidden");

			if (currentDisplayCategory === "Equipment") {
				document.querySelector("#atk .infoTitle").textContent = "攻擊力";
				document.querySelector("#hp .infoTitle").textContent = "生命";
				document.getElementById("powerHint").classList.add("hidden");
			} else {
				document.querySelector("#atk .infoTitle").textContent = "基礎攻擊力";
				document.querySelector("#hp .infoTitle").textContent = "基礎生命";
				document.getElementById("powerHint").classList.remove("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["稀有度"] != null) {
				document.getElementById("rarity").classList.remove("hidden");
				document.querySelector("#rarity .infoValue").textContent = wholeData[currentDisplayCategory][id]["稀有度"];
			} else {
				document.getElementById("rarity").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["星數"] != null) {
				document.getElementById("stars").classList.remove("hidden");
				document.querySelector("#stars .infoValue").textContent = wholeData[currentDisplayCategory][id]["星數"];
			} else {
				document.getElementById("stars").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["擅長武器"] != null) {
				document.getElementById("preferredWeapon").classList.remove("hidden");
				document.querySelector("#preferredWeapon .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["擅長武器"];

				if (wholeData[currentDisplayCategory][id]["被動加成外顯"]) {
					for (const bonusEffect of Object.values(wholeData[currentDisplayCategory][id]["被動加成外顯"])) {
						const preferredWeapon2Name = bonusEffect?.["擅長武器+"];
						if (preferredWeapon2Name) {
							const prefWeap2_inner = document.createElement("span");
							prefWeap2_inner.id = "prefWeapon2";
							prefWeap2_inner.textContent = preferredWeapon2Name;
							const prefWeap2 = document.createElement("div");
							prefWeap2.appendChild(prefWeap2_inner);
							document.querySelector("#preferredWeapon .infoValue").appendChild(prefWeap2);
						}
					}
				}
			} else {
				document.getElementById("preferredWeapon").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["類型"] != null) {
				document.getElementById("weaponType").classList.remove("hidden");
				document.querySelector("#weaponType .infoValue").textContent = wholeData[currentDisplayCategory][id]["類型"];
			} else {
				document.getElementById("weaponType").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["屬性"] != null) {
				document.getElementById("element").classList.remove("hidden");
				document.querySelector("#element .infoValue").textContent = wholeData[currentDisplayCategory][id]["屬性"];
			} else {
				document.getElementById("element").classList.add("hidden");
			}
			if (wholeData[currentDisplayCategory][id]["Cost"] != null) {
				document.getElementById("cost").classList.remove("hidden");
				document.querySelector("#cost .infoValue").textContent = wholeData[currentDisplayCategory][id]["Cost"];
			} else {
				document.getElementById("cost").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["基礎攻擊力"] != null) |
				(wholeData[currentDisplayCategory][id]["攻擊力"] != null)
			) {
				document.getElementById("atk").classList.remove("hidden");
				document.querySelector("#atk .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["基礎攻擊力"] ?? wholeData[currentDisplayCategory][id]["攻擊力"];
			} else {
				document.getElementById("atk").classList.add("hidden");
			}

			if (
				(wholeData[currentDisplayCategory][id]["基礎生命"] != null) |
				(wholeData[currentDisplayCategory][id]["生命"] != null)
			) {
				document.getElementById("hp").classList.remove("hidden");
				document.querySelector("#hp .infoValue").textContent =
					wholeData[currentDisplayCategory][id]["基礎生命"] ?? wholeData[currentDisplayCategory][id]["生命"];
			} else {
				document.getElementById("hp").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["速度"] != null) {
				document.getElementById("speed").classList.remove("hidden");
				document.querySelector("#speed .infoValue").textContent = wholeData[currentDisplayCategory][id]["速度"];
			} else {
				document.getElementById("speed").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["戰力"] != null) {
				document.getElementById("power").classList.remove("hidden");
				document.querySelector("#power .infoValue").textContent = wholeData[currentDisplayCategory][id]["戰力"];
			} else {
				document.getElementById("power").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["自動進化"] != null) {
				document.getElementById("freeEvo").classList.remove("hidden");
				const evoLv = `Lv.${wholeData[currentDisplayCategory][id]["自動進化"]["進化等級"]}`;
				const evoTarget = setNameAndLink(
					wholeData[currentDisplayCategory][id]["自動進化"]["進化目標"],
					"Monster",
					true,
					false
				);
				document.querySelector("#freeEvo .infoValue").innerHTML = `${evoLv}<br>${evoTarget.outerHTML}`;
			} else {
				document.getElementById("freeEvo").classList.add("hidden");
			}

			if (wholeData[currentDisplayCategory][id]["圖鑑可見"]) {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✔";
			} else {
				document.getElementById("visible").classList.remove("hidden");
				document.querySelector("#visible .infoValue").textContent = "✗";
			}
		}

		function setProfile(id) {
			if (wholeData[currentDisplayCategory][id]["簡介"]) {
				document.getElementById("profileArea").classList.remove("hidden");
				document.getElementById("profileText").innerText = wholeData[currentDisplayCategory][id]["簡介"];

				document.getElementById("hasAscended")?.remove();
				if (wholeData[currentDisplayCategory][id]["簡介_已超越(滿覺)"] != null) {
					const templateHasAscended = document.getElementById("template-hasAscended").content.cloneNode(true);
					templateHasAscended.getElementById("profileAscendedText").innerText =
						wholeData[currentDisplayCategory][id]["簡介_已超越(滿覺)"];
					document.getElementById("profileContent").appendChild(templateHasAscended);
				}
			} else {
				document.getElementById("profileArea").classList.add("hidden");
			}
		}

		function setLeaderSkill(id) {
			if (wholeData[currentDisplayCategory][id]["隊長技能"]) {
				document.getElementById("leaderSkillArea").classList.remove("hidden");
				document.getElementById("leaderSkillName").innerText =
					wholeData[currentDisplayCategory][id]["隊長技能"]["技能標題"];
				document.getElementById("leaderSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["隊長技能"]["技能敘述"];
			} else {
				document.getElementById("leaderSkillArea").classList.add("hidden");
			}
		}

		function setWeaponSkill(id) {
			if (wholeData[currentDisplayCategory][id]["武器技能"]) {
				document.getElementById("weaponSkillArea").classList.remove("hidden");
				document.getElementById("weaponSkillName").innerText =
					wholeData[currentDisplayCategory][id]["武器技能"][0]["技能標題"];
				document.getElementById("weaponSkillDecription").innerText =
					wholeData[currentDisplayCategory][id]["武器技能"][0]["技能敘述"];
			} else {
				document.getElementById("weaponSkillArea").classList.add("hidden");
			}
		}

		function setActiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["主動技能"]) {
				document.getElementById("activeSkillArea").classList.remove("hidden");
				document.getElementById("activeSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["主動技能"].entries()) {
					const templateActiveSkill = document.getElementById("template-activeSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".activeSkillDetail").id = "activeSkill_" + (index + 1);
					templateActiveSkill.querySelector(".activeSkillName").innerText = mySkill["技能標題"];
					templateActiveSkill.querySelector(".activeSkillSpirit").innerText = "靈氣 " + mySkill["靈氣"];
					templateActiveSkill.querySelector(".activeSkillTU").innerText = mySkill["TU"] + " TU";
					templateActiveSkill.querySelector(".activeSkillDecription").innerText = mySkill["技能敘述"];

					document.getElementById("activeSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("activeSkillArea").classList.add("hidden");
			}
		}

		function setPassiveSkill(id) {
			if (wholeData[currentDisplayCategory][id]["被動技能"]) {
				document.getElementById("passiveSkillArea").classList.remove("hidden");
				document.getElementById("passiveSkillContent").innerHTML = "";

				for (const [index, mySkill] of wholeData[currentDisplayCategory][id]["被動技能"].entries()) {
					const templateActiveSkill = document.getElementById("template-passiveSkill").content.cloneNode(true);
					templateActiveSkill.querySelector(".passiveSkillDetail").id = "passiveSkill_" + (index + 1);
					templateActiveSkill.querySelector(".passiveSkillName").innerText = mySkill["技能標題"];
					templateActiveSkill.querySelector(".passiveSkillDecription").innerText = mySkill["技能敘述"];

					document.getElementById("passiveSkillContent").appendChild(templateActiveSkill);
				}
			} else {
				document.getElementById("passiveSkillArea").classList.add("hidden");
			}
		}

		function setGachaIntro(id) {
			if (wholeData[currentDisplayCategory][id]["召喚導言"]) {
				document.getElementById("gachaIntroArea").classList.remove("hidden");
				document.getElementById("gachaIntroText").innerText = wholeData[currentDisplayCategory][id]["召喚導言"];
			} else {
				document.getElementById("gachaIntroArea").classList.add("hidden");
			}
		}

		function setDialog(id) {
			if (wholeData[currentDisplayCategory][id]["對話"]) {
				document.getElementById("dialogArea").classList.remove("hidden");
				document.getElementById("dialogContent").innerHTML = "";

				const dailogSort = {
					Gacha: "召喚",
					Login: "主畫面登入",
					Tap: "主畫面點擊",
					Idle: "主畫面閒置",
				};

				for (const [key, title] of Object.entries(dailogSort)) {
					if (!wholeData[currentDisplayCategory][id]["對話"][title]) continue;

					const templateDialog = document.getElementById("template-dialog").content.cloneNode(true);
					templateDialog.querySelector(".dialogGroup").id = "dialog_" + key;
					templateDialog.querySelector(".dialogGroupTitle").innerText = title;

					for (const dialogText of wholeData[currentDisplayCategory][id]["對話"][title]) {
						if (!dialogText) continue;
						const templateDialogText = templateDialog.querySelector(".dialogText").cloneNode(true);
						templateDialogText.innerText = dialogText;
						templateDialog.querySelector(".dialogGroup").appendChild(templateDialogText);
					}
					//若無添加，則只有模板當初的2子元素
					if (templateDialog.querySelector(".dialogGroup").children.length <= 2) continue;

					templateDialog.querySelector(".dialogText").remove();
					document.getElementById("dialogContent").appendChild(templateDialog);
				}
			} else {
				document.getElementById("dialogArea").classList.add("hidden");
			}
		}

		function setAiLogic(id) {
			if (wholeData[currentDisplayCategory][id]["AI邏輯"]) {
				document.getElementById("aiLogicArea").classList.remove("hidden");
				//刪除最外層的{}，並統一減少1縮排
				let jsonText = JSON.stringify(wholeData[currentDisplayCategory][id]["AI邏輯"], null, "\t");
				jsonText = jsonText.split("\n").slice(1, -1);
				jsonText = jsonText.map((line) => line.replace(/^\t/, ""));
				jsonText = jsonText.join("\n");

				document.getElementById("aiLogicContent").innerText = jsonText;
			} else {
				document.getElementById("aiLogicArea").classList.add("hidden");
			}
		}

		function getFullNameAddStarsOrRarity(id, category, addStars = true, addRarity = false) {
			let longName = wholeData[category][id]["完整名"];
			if (addStars) longName += ` (${wholeData[category][id]["星數"]})`;
			if (addRarity) longName += ` (${wholeData[category][id]["稀有度"]})`;
			return longName;
		}

		function analyzeUrlParams() {
			try {
				const params = new URLSearchParams(window.location.search);
				if (!params.toString()) return;
				history.replaceState(null, "", window.location.pathname);

				const id = params.get("id");
				let category = params.get("category");
				if (id || category) {
					if (!id && category) {
						//不能只有category
						throw new Error("id參數不可少");
					}

					if (id && !category) {
						//若沒傳入category則遍歷搜尋
						category = (() => {
							for (const [type, ids] of Object.entries(wholeData)) {
								if (id in ids) return type;
							}
							throw new Error("id參數錯誤");
						})();
					}

					if (wholeData?.[category]?.[id]) {
						displayData(id, category);
					} else {
						throw new Error("id或category參數錯誤");
					}
				}
			} catch (e) {
				alert(e);
				console.error(e);
			}
		}

		function setNameAndLink(id, category, addStars = true, addRarity = false) {
			const linkElement = document.createElement("a");
			linkElement.href = `?id=${id}&category=${category}`;
			linkElement.textContent = getFullNameAddStarsOrRarity(id, category, addStars, addRarity);
			return linkElement;
		}

		function setSummonableMonsters(id) {
			if (wholeData[currentDisplayCategory][id]["召喚物"]) {
				document.getElementById("summonableMonstersArea").classList.remove("hidden");
				const combination = wholeData[currentDisplayCategory][id]["召喚物"]
					.map((conjureID) => setNameAndLink(conjureID, "Monster", true, false).outerHTML)
					.join("<br>");
				document.getElementById("summonableMonstersContent").innerHTML = combination;
			} else {
				document.getElementById("summonableMonstersArea").classList.add("hidden");
			}
		}

		function setRelationship(id) {
			if (wholeData[currentDisplayCategory][id]["夥伴"]) {
				document.getElementById("relationshipArea").classList.remove("hidden");
				document.getElementById("relationshipContent").innerHTML = "";

				for (const oneRelationship of Object.values(wholeData[currentDisplayCategory][id]["夥伴"])) {
					const templateRelationship = document.getElementById("template-relationship").content.cloneNode(true);
					templateRelationship.querySelector(".relationshipName").innerText = oneRelationship["夥伴關係"];
					templateRelationship.querySelector(".relationshipBonus").innerText = oneRelationship["夥伴加成"].replace(
						"+",
						"\n+"
					);

					const memberlist = document.createElement("ul");
					for (const charID of oneRelationship["夥伴成員"]) {
						const listItem = document.createElement("li");
						listItem.appendChild(setNameAndLink(charID, "Monster", false, true));
						memberlist.appendChild(listItem);
					}
					templateRelationship.querySelector(".relationshipMembers").appendChild(memberlist);

					document.getElementById("relationshipContent").appendChild(templateRelationship);
				}
			} else {
				document.getElementById("relationshipArea").classList.add("hidden");
			}
		}

		function collapseContent(triggerElement) {
			triggerElement.innerText = !triggerElement.nextElementSibling.classList.contains("hidden") ? "⊕" : "⊖";
			triggerElement.nextElementSibling.classList.toggle("hidden");
		}

		function collapseReset() {
			document.querySelectorAll(".collapseButton").forEach(function (el) {
				el.nextElementSibling.classList.remove("hidden");
				el.innerText = "⊖";
			});
		}
	</script>
	<script>
		/*=====戰力計算區塊=====*/
		let nowInfiniteMode = false;

		function initStatsInput(id) {
			if (currentDisplayCategory !== "Equipment") {
				id ??= currentDisplayID;
				document.getElementById("input_atkBase").value = 0;
				document.getElementById("input_hpBase").value = 0;
				document.getElementById("input_starsCurrent").value = 0;
				document.getElementById("input_starsMax").value = 0;
				document.getElementById("input_limitBreak").value = 0;
				document.getElementById("input_level").value = 1;
				document.getElementById("input_awakening").value = 0;
				document.getElementById("input_cosmo").checked = false;
				document.getElementById("input_cosmo").disabled = true;
				document.getElementById("input_boost").value = 0;
				document.getElementById("input_refine").value = "0.00";
				document.getElementById("input_mastery").value = 0;

				document.getElementById("infiniteMode").checked = false;
				nowInfiniteMode = false;
				document.getElementById("result_atk").value = "";
				document.getElementById("result_hp").value = "";
				document.getElementById("result_atk").dataset.trueval = 0;
				document.getElementById("result_hp").dataset.trueval = 0;
				document.getElementById("result_atk").dataset.awkbonus = 0;
				document.getElementById("result_hp").dataset.awkbonus = 0;
				document.getElementById("result_power").value = "";
				document.getElementById("resultInvolvePassive").checked = true;

				setStatsVal(id);

				document.getElementById("powerCalculatorArea").classList.remove("hidden");
			} else {
				document.getElementById("powerCalculatorArea").classList.add("hidden");
			}
		}
		function setStatsVal(id) {
			id ??= currentDisplayID;

			document.getElementById("input_atkBase").value = wholeData[currentDisplayCategory][id]["基礎攻擊力"];
			document.getElementById("input_atkBase").readOnly = true;
			document.getElementById("hint_atkBase").classList.add("hidden");

			document.getElementById("input_hpBase").value = wholeData[currentDisplayCategory][id]["基礎生命"];
			document.getElementById("input_hpBase").readOnly = true;
			document.getElementById("hint_hpBase").classList.add("hidden");

			document.getElementById("input_starsCurrent").value = wholeData[currentDisplayCategory][id]["目前星數"];
			document.getElementById("input_starsCurrent").readOnly = true;
			document.getElementById("hint_starsCurrent").classList.add("hidden");

			document.getElementById("input_starsMax").value = wholeData[currentDisplayCategory][id]["最大星數"];
			document.getElementById("input_starsMax").readOnly = true;
			document.getElementById("hint_starsMax").classList.add("hidden");

			if (wholeData[currentDisplayCategory][id]["最大星數"] > 3) {
				document.getElementById("pc_limitBreakInput").classList.remove("hidden");
				setLimitBreakLabel(id);
			} else {
				document.getElementById("pc_limitBreakInput").classList.add("hidden");
				setLimitBreakLabel(id);
			}

			setLevelLabel(id);

			document.getElementById("input_awakening").max = 4;
			document.getElementById("hint_awakening").textContent = `${document.getElementById("input_awakening").min}~${document.getElementById("input_awakening").max
				}`;
			if (wholeData[currentDisplayCategory][id]["最大星數"] > 3) {
				document.getElementById("pc_awakeningInput").classList.remove("hidden");
			} else {
				document.getElementById("pc_awakeningInput").classList.add("hidden");
			}

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["目前星數"] === 6) {
				document.getElementById("pc_cosmoInput").classList.remove("hidden");
			} else {
				document.getElementById("pc_cosmoInput").classList.add("hidden");
			}

			document.getElementById("input_boost").max = 300;
			document.getElementById("hint_boost").textContent = `${document.getElementById("input_boost").min}~${document.getElementById("input_boost").max
				}`;

			document.getElementById("input_refine").max = "100.00";
			document.getElementById("hint_refine").textContent = `${document.getElementById("input_refine").min}~${document.getElementById("input_refine").max
				}`;
			if (document.getElementById("input_level").value >= 40) {
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").readOnly = true;
			}

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["最大星數"] > 3) {
				document.getElementById("pc_masteryInput").classList.remove("hidden");
				document.getElementById("input_mastery").max = 40;
				document.getElementById("hint_mastery").textContent = `${document.getElementById("input_mastery").min}~${document.getElementById("input_mastery").max
					}`;
			} else {
				document.getElementById("pc_masteryInput").classList.add("hidden");
			}

			if (currentDisplayCategory === "Monster") {
				document.getElementById("checkbox_resultInvolvePassive").classList.remove("hidden");
			} else {
				document.getElementById("checkbox_resultInvolvePassive").classList.add("hidden");
			}
		}

		function setLimitBreakLabel(id) {
			id ??= currentDisplayID;
			document.getElementById("input_limitBreak").min = wholeData[currentDisplayCategory][id]["起始突破次"] ?? 0;
			document.getElementById("input_limitBreak").max =
				wholeData[currentDisplayCategory][id]["目前星數"] === wholeData[currentDisplayCategory][id]["最大星數"]
					? Number(document.getElementById("input_limitBreak").min) + 5
					: document.getElementById("input_limitBreak").min;
			document.getElementById("input_limitBreak").value = document.getElementById("input_limitBreak").min;
			document.getElementById("hint_limitBreak").textContent =
				document.getElementById("input_limitBreak").min === document.getElementById("input_limitBreak").max
					? document.getElementById("input_limitBreak").min
					: `${document.getElementById("input_limitBreak").min}~${document.getElementById("input_limitBreak").max}`;
		}

		function setLevelLabel(id) {
			id ??= currentDisplayID;
			const currentLv = document.getElementById("input_level").value;
			document.getElementById("input_level").min = getLowestLV(id);
			document.getElementById("input_level").max = getHigestLV(id);
			document.getElementById("input_level").value =
				currentLv >= document.getElementById("input_level").min &&
					currentLv <= document.getElementById("input_level").max
					? currentLv
					: document.getElementById("input_level").min;
			document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~${document.getElementById("input_level").max
				}`;
		}

		function getLowestLV(id) {
			let lv = 1;
			const limitBreakValue = document.getElementById("input_limitBreak").value;
			if (limitBreakValue == 0) {
				preID = id.slice(0, -2) + String(Number(id.slice(-2)) - 1).padStart(2, "0");
				lv = wholeData[currentDisplayCategory]?.[preID]?.["自動進化"]?.["進化等級"] ?? 1;
			} else if (limitBreakValue == document.getElementById("input_limitBreak").min) {
				lv = getMaxLv(
					wholeData[currentDisplayCategory][id]["目前星數"] - 1,
					wholeData[currentDisplayCategory][id]["最大星數"],
					0
				);
			} else {
				lv = getMaxLv(
					wholeData[currentDisplayCategory][id]["目前星數"],
					wholeData[currentDisplayCategory][id]["最大星數"],
					limitBreakValue - Number(document.getElementById("input_limitBreak").min) - 1
				);
			}
			return lv;
		}

		function getHigestLV(id) {
			let lv =
				wholeData[currentDisplayCategory]?.[id]?.["自動進化"]?.["進化等級"] ??
				getMaxLv(
					wholeData[currentDisplayCategory][id]["目前星數"],
					wholeData[currentDisplayCategory][id]["最大星數"],
					document.getElementById("input_limitBreak").value - Number(document.getElementById("input_limitBreak").min)
				);
			return lv;
		}

		function getMaxLv(currStars, maxStars, extraEvolves) {
			let level = 30;
			if (currStars <= 3) {
				if (currStars === 3 && maxStars === 4) {
					level = 50;
				} else {
					level = 30;
				}
			} else {
				if (currStars === 4) level = 60;
				if (currStars === 5) level = 80;
				if (currStars === 6) level = 100;

				if (currStars === maxStars || nowInfiniteMode) level += 20 * extraEvolves;
			}

			return level;
		}

		document.getElementById("input_atkBase").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			v = Math.max(v, minV);
			this.value = v;
		});

		document.getElementById("input_hpBase").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			v = Math.max(v, minV);
			this.value = v;
		});

		document.getElementById("input_starsCurrent").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_starsMax").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_limitBreak").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			if (!nowInfiniteMode) {
				setLevelLabel();
				if (document.getElementById("input_level").value >= 40 || nowInfiniteMode) {
					document.getElementById("input_refine").readOnly = false;
				} else {
					document.getElementById("input_refine").readOnly = true;
					document.getElementById("input_refine").value = document.getElementById("input_refine").min;
				}
			}
		});

		document.getElementById("input_level").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = !nowInfiniteMode ? this.min : 1;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			if (v >= 40 || nowInfiniteMode) {
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").readOnly = true;
				document.getElementById("input_refine").value = document.getElementById("input_refine").min;
			}
			checkCosmoUnlock();
		});

		document.getElementById("input_awakening").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
			checkCosmoUnlock();
		});

		function checkCosmoUnlock() {
			if (
				(document.getElementById("input_awakening").value >= 4 &&
					document.getElementById("input_level").value >= 100) ||
				nowInfiniteMode
			) {
				document.getElementById("input_cosmo").disabled = false;
			} else {
				document.getElementById("input_cosmo").disabled = true;
				document.getElementById("input_cosmo").checked = false;
			}
		}

		document.getElementById("input_boost").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_mastery").addEventListener("change", function () {
			let v = Math.floor(this.value);
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			this.value = v;
		});

		document.getElementById("input_refine").addEventListener("change", function () {
			let v = Number(this.value);
			if (isNaN(v)) v = this.min;
			minV = this.min;
			maxV = this.max;
			v = Math.max(v, minV);
			v = Math.min(v, maxV);
			v = Math.floor(v * 100) / 100;
			this.value = v.toFixed(2);
		});

		document.getElementById("infiniteMode").addEventListener("change", function () {
			if (this.checked) {
				nowInfiniteMode = true;
				document.getElementById("input_atkBase").readOnly = false;
				document.getElementById("hint_atkBase").classList.remove("hidden");

				document.getElementById("input_hpBase").readOnly = false;
				document.getElementById("hint_hpBase").classList.remove("hidden");

				document.getElementById("input_starsCurrent").readOnly = false;
				document.getElementById("hint_starsCurrent").classList.remove("hidden");

				document.getElementById("input_starsMax").readOnly = false;
				document.getElementById("hint_starsMax").classList.remove("hidden");

				document.getElementById("pc_limitBreakInput").classList.remove("hidden");
				document.getElementById("input_limitBreak").max = Infinity;
				document.getElementById("hint_limitBreak").textContent = `${document.getElementById("input_limitBreak").min
					}~`;

				document.getElementById("input_level").min = 1;
				document.getElementById("input_level").max = Infinity;
				document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~`;

				document.getElementById("pc_awakeningInput").classList.remove("hidden");
				document.getElementById("input_awakening").max = Infinity;
				document.getElementById("hint_awakening").textContent = `${document.getElementById("input_awakening").min}~`;

				document.getElementById("input_boost").max = Infinity;
				document.getElementById("hint_boost").textContent = `${document.getElementById("input_boost").min}~`;

				document.getElementById("input_refine").max = Infinity;
				document.getElementById("hint_refine").textContent = `${document.getElementById("input_refine").min}~`;
				document.getElementById("input_refine").readOnly = false;

				if (currentDisplayCategory === "Monster") {
					document.getElementById("pc_cosmoInput").classList.remove("hidden");
					document.getElementById("input_cosmo").disabled = false;

					document.getElementById("input_mastery").max = Infinity;
					document.getElementById("hint_mastery").textContent = `${document.getElementById("input_mastery").min}~`;
					document.getElementById("pc_masteryInput").classList.remove("hidden");
				}
			} else {
				nowInfiniteMode = false;
				initStatsInput();
			}
		});

		document.getElementById("button_maxStats").addEventListener("click", function () {
			const id = currentDisplayID;
			document.getElementById("input_atkBase").value = wholeData[currentDisplayCategory][id]["基礎攻擊力"];
			document.getElementById("input_hpBase").value = wholeData[currentDisplayCategory][id]["基礎生命"];
			document.getElementById("input_starsCurrent").value = wholeData[currentDisplayCategory][id]["目前星數"];
			document.getElementById("input_starsMax").value = wholeData[currentDisplayCategory][id]["最大星數"];

			document.getElementById("input_limitBreak").value =
				wholeData[currentDisplayCategory][id]["最大星數"] > 3
					? wholeData[currentDisplayCategory][id]["目前星數"] === wholeData[currentDisplayCategory][id]["最大星數"]
						? Number(document.getElementById("input_limitBreak").min) + 5
						: document.getElementById("input_limitBreak").min
					: 0;
			if (!nowInfiniteMode) {
				document.getElementById("input_level").min = getLowestLV(id);
				document.getElementById("input_level").max = getHigestLV(id);
				document.getElementById("hint_level").textContent = `${document.getElementById("input_level").min}~${document.getElementById("input_level").max
					}`;
			}

			document.getElementById("input_level").value =
				wholeData[currentDisplayCategory]?.[id]?.["自動進化"]?.["進化等級"] ??
				getMaxLv(
					wholeData[currentDisplayCategory][id]["目前星數"],
					wholeData[currentDisplayCategory][id]["最大星數"],
					document.getElementById("input_limitBreak").value - Number(document.getElementById("input_limitBreak").min)
				);

			document.getElementById("input_awakening").value =
				wholeData[currentDisplayCategory][id]["最大星數"] > 3 ? 4 : 0;

			if (currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["目前星數"] === 6) {
				document.getElementById("input_cosmo").checked = true;
				document.getElementById("input_cosmo").disabled = false;
			} else {
				document.getElementById("input_cosmo").checked = false;
			}

			document.getElementById("input_boost").value = 300;

			if (document.getElementById("input_level").value >= 40) {
				document.getElementById("input_refine").value = "100.00";
				document.getElementById("input_refine").readOnly = false;
			} else {
				document.getElementById("input_refine").value = "0.00";
			}

			document.getElementById("input_mastery").value =
				currentDisplayCategory === "Monster" && wholeData[currentDisplayCategory][id]["最大星數"] > 3 ? 40 : 0;
		});

		document.getElementById("button_calcPower").addEventListener("click", function () {
			const id = currentDisplayID;
			const isWeapon = currentDisplayCategory === "Weapon" ? true : false;
			const statsInput = {
				baseAtk: Number(document.getElementById("input_atkBase").value),
				baseHp: Number(document.getElementById("input_hpBase").value),
				starsCurrent: Number(document.getElementById("input_starsCurrent").value),
				starsMax: Number(document.getElementById("input_starsMax").value),
				extraEvolves:
					document.getElementById("input_limitBreak").value - document.getElementById("input_limitBreak").min,
				level: Number(document.getElementById("input_level").value),
				awakening: Number(document.getElementById("input_awakening").value),
				isCosmo: document.getElementById("input_cosmo").checked,
				boost: Number(document.getElementById("input_boost").value),
				refine: Number(document.getElementById("input_refine").value) * 100,
				mastery: Number(document.getElementById("input_mastery").value),
			};

			if (isWeapon) {
				let [reslutAtk, resultHp] = [
					Math.floor(calculateStatAprox(true, isWeapon, false, statsInput)),
					Math.floor(calculateStatAprox(false, isWeapon, false, statsInput)),
				];
				document.getElementById("result_atk").dataset.trueval = reslutAtk;
				document.getElementById("result_hp").dataset.trueval = resultHp;

				document.getElementById("result_atk").value = reslutAtk.toLocaleString();
				document.getElementById("result_hp").value = resultHp.toLocaleString();
			} else {
				let [reslutAtk, resultHp] = [
					bankersRound(calculateStatAprox(true, isWeapon, false, statsInput)),
					bankersRound(calculateStatAprox(false, isWeapon, false, statsInput)),
				];
				document.getElementById("result_atk").dataset.trueval = reslutAtk;
				document.getElementById("result_hp").dataset.trueval = resultHp;

				let [bonusAtk, bonusHp] = [0, 0];
				for (let i = 0; i <= statsInput.awakening; i++) {
					bonusAtk += wholeData[currentDisplayCategory][id]["被動加成外顯"]?.[i]?.["攻擊力+"] ?? 0;
					bonusHp += wholeData[currentDisplayCategory][id]["被動加成外顯"]?.[i]?.["最大生命+"] ?? 0;
				}
				document.getElementById("result_atk").dataset.awkbonus = bonusAtk;
				document.getElementById("result_hp").dataset.awkbonus = bonusHp;

				const hasPassiveBonus = document.getElementById("resultInvolvePassive").checked;
				document.getElementById("result_atk").value = (reslutAtk += hasPassiveBonus ? bonusAtk : 0).toLocaleString();
				document.getElementById("result_hp").value = (resultHp += hasPassiveBonus ? bonusHp : 0).toLocaleString();
			}
			document.getElementById("result_power").value = calculateFinalPower(
				Math.floor(calculateStatAprox(true, isWeapon, true, statsInput)),
				Math.floor(calculateStatAprox(false, isWeapon, true, statsInput)),
				isWeapon,
				statsInput.mastery,
				statsInput.starsMax
			).toLocaleString();
		});

		function calculateStatAprox(isAtk, isWeapon, forPower, statsForCalc) {
			const baseStat = isAtk ? statsForCalc.baseAtk : statsForCalc.baseHp;
			let statVal = 0;
			statVal =
				baseStat *
				(1 + (statsForCalc.level - 30) * 0.025) *
				(statsForCalc.extraEvolves * 0.08 + 1) *
				(statsForCalc.refine / 10000 + 1);

			if (forPower) {
				statVal_temp1 = statVal * getBonus_Awakening(isWeapon, statsForCalc.awakening, statsForCalc.starsMax);
				statVal_temp2 = statVal + getMultiplier_Awakening(isAtk, statsForCalc.starsMax) * statsForCalc.awakening;
				statVal = Math.max(statVal_temp1, statVal_temp2);
			} else {
				statVal *= getBonus_Awakening(isWeapon, statsForCalc.awakening, statsForCalc.starsMax);
			}

			statVal += getBonus_Boost(isAtk, isWeapon, statsForCalc.boost);

			if (!isWeapon && statsForCalc.isCosmo) {
				const extraEvolvesForMaxLv = statsForCalc.starsMax > 3 ? 5 : 0;
				statVal +=
					baseStat *
					(1 + (getMaxLv(statsForCalc.starsCurrent, statsForCalc.starsMax, extraEvolvesForMaxLv) - 30) * 0.025) *
					((statsForCalc.refine / 10000 + 1) * 0.07);
			}

			return statVal;
		}

		function getBonus_Awakening(isWeapon, awakening, maxStar) {
			switch (maxStar) {
				case 4:
					return awakening * 0.05 + 1;
				case 5:
					return awakening * 0.075 + 1;
				case 6:
					if (isWeapon) {
						switch (awakening) {
							case 0:
								return 1;
							case 1:
								return 1.19;
							case 2:
								return 1.33;
							case 3:
								return 1.44;
							default:
								return 1.55;
						}
					} else {
						switch (awakening) {
							case 0:
								return 1;
							case 1:
								return 1.22;
							case 2:
								return 1.44;
							case 3:
								return 1.66;
							default:
								return 1.88;
						}
					}
				default:
					return 1;
			}
		}

		function getMultiplier_Awakening(isAtk, maxStar) {
			switch (maxStar) {
				case 6:
					return isAtk ? 248 : 1239;
				case 5:
					return isAtk ? 82 : 412;
				case 4:
					return isAtk ? 40 : 201;
				default:
					return 0;
			}
		}

		function getBonus_Boost(isAtk, isWeapon, boost) {
			const boost_lowerPart = boost > 90 ? 90 : boost;
			const boost_upperPart = boost > 90 ? boost - 90 : 0;

			const weight_lower = isAtk ? 3 : 14;
			const weight_upper = isAtk ? (isWeapon ? 3 : 73) : isWeapon ? 14 : 311;

			return weight_lower * boost_lowerPart + weight_upper * boost_upperPart;
		}
		function bankersRound(v) {
			let intPart = Math.floor(v);
			let fracPart = v - intPart;

			if (Math.abs(fracPart) !== 0.5) {
				return Math.round(v);
			} else {
				return intPart % 2 === 0 ? intPart : intPart + (v > 0 ? 1 : -1);
			}
		}
		function calculateFinalPower(trueAtk, trueHp, isWeapon, masteryLevel, maxStar) {
			let powerVal = 0;
			powerVal = trueAtk * 30 + trueHp * 6;
			if (!isWeapon) {
				powerVal *= 1 + masteryLevel * 0.005;
				switch (maxStar) {
					case 6:
						powerVal *= 2;
						break;
					case 5:
						powerVal *= 1.5;
						break;
				}
			}
			return bankersRound(powerVal);
		}

		document.getElementById("resultInvolvePassive").addEventListener("change", function () {
			if (document.getElementById("result_atk").value !== "" && document.getElementById("result_hp").value !== "") {
				const [reslutAtk, resultHp] = [
					Number(document.getElementById("result_atk").dataset.trueval),
					Number(document.getElementById("result_hp").dataset.trueval),
				];
				const [bonusAtk, bonusHp] = document.getElementById("resultInvolvePassive").checked
					? [
						Number(document.getElementById("result_atk").dataset.awkbonus),
						Number(document.getElementById("result_hp").dataset.awkbonus),
					]
					: [0, 0];

				document.getElementById("result_atk").value = (reslutAtk + bonusAtk).toLocaleString();
				document.getElementById("result_hp").value = (resultHp + bonusHp).toLocaleString();
			}
		});
	</script>
</body>

</html>